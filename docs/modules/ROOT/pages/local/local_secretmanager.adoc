[[lokal_secretmanager]]
= Google Cloud Secret Manager

Noen hemmeligheter lagres i Secret Manager, som tilsvarer tidligere Vault. Disse hentes automatisk av applikasjonen ved oppstart lokalt gitt at man autentiserer seg med gcloud CLI først.

[[lokal_secretmanager_prosjekt]]
== Sette prosjekt

For Dolly er prosjektet `dolly-dev-ff83`:

----
gcloud config set project dolly-dev-ff83
----

[[lokal_secretmanager_login]]
== Innlogging

----
gcloud auth login --update-adc
----

NB: `--update-adc` er viktig. Se dokumentasjon om Application Default Credentials.

Alternativt via NAIS CLI:

----
nais login
----

[[lokal_secretmanager_avhengighet]]
== Avhengighet

Legg til dependency på `com.google.cloud:spring-cloud-gcp-starter-secretmanager` (allerede inkludert via interne plugins hvis du bruker dem).

[[lokal_secretmanager_konfig]]
== Spring konfigurasjon

Eksempel i `application-local.yml`:

----
AZURE_APP_CLIENT_ID: ${sm://azure-app-client-id}
AZURE_APP_CLIENT_SECRET: ${sm://azure-app-client-secret}

spring:
  config:
    import: "sm://"
----

Ingen ekstra kode kreves; verdier injiseres som vanlige properties.

